USE TPCH;
GO

DROP FUNCTION IF EXISTS dbo.p1_last_5y;
GO

CREATE FUNCTION dbo.p1_last_5y(@shipdate DATE)
RETURNS TABLE WITH SCHEMABINDING
AS
RETURN
SELECT 1 AS allowed
WHERE USER_NAME() = 'user3'
   OR @shipdate >= DATEADD(YEAR, -5, CAST(GETDATE() AS DATE));
GO
